<!DOCTYPE html>
<html>
    <head>
        <style>
            #game-canvas {
                border: 1px solid black;
                border-radius: 15px;
                
                width: 640px;
                height: 600px;
            }
            
            body {
                margin: 0;
				-moz-user-select: none; 
				-khtml-user-select: none; 
				-webkit-user-select: none; 
				-o-user-select: none; 
				-user-select: none;
            }
        </style>
    </head>
    
    <body>
        <canvas id="game-canvas" width="640px" height="600px"></canvas>
    </body>
    
    <script>
        var canvas = document.getElementById("game-canvas"),
            context = canvas.getContext("2d");
        //game test
		var lost = false, win = false;
		
        Array.prototype.remove = function(from, to) {
          var rest = this.slice((to || from) + 1 || this.length);
          this.length = from < 0 ? this.length + from : from;
          return this.push.apply(this, rest);
        };
        
        function vector(x, y) {
            this.x = x;
            this.y = y;
            
            this.dx = 0;
            this.dy = 0;
            
            this.mass = 0.95;
            
            this.add = function(vec) {
                this.x += vec.x;
                this.y += vec.y;
            }
            
            this.multiply = function(num) {
                this.x *= num;
                this.y *= num;
            }
            
            this.divide = function(num) {
                this.x /= num;
                this.y /= num;
            }
        }
        
        var gravity = new vector(0, 0.6),
            rope = [];
        
        
        var ropeLength = 40;
        
		function reset() {
			for (var i = 0; i < 10; ++ i) {
				rope[i] = new vector(500 - i * ropeLength, 100);
			}
			rope[3].mass = 0.97;
			rope[6].mass = 1;
		}
		
		reset();
		
        var dragging;
        
        canvas.ontouchstart = handleStart;
		canvas.onmousedown = handleStart;
		canvas.ontouchend = handleEnd;
		canvas.onmouseup = handleEnd;
		canvas.ontouchmove = handleMove;
		canvas.onmousemove = handleMove;
		
		function handleStart(mouse) {
			mouse = mouse.touches ? mouse.touches[0] : mouse;
            dragging = undefined;
            
            for (var i in rope) {
                if (mouse.clientX >= rope[i].x - 30 && mouse.clientX <= rope[i].x + 30 &&
                    mouse.clientY >= rope[i].y - 30 && mouse.clientY <= rope[i].y + 30)
                    dragging = i;
            }
        }
        
        var mouse;
        function handleEnd() {
            if (dragging && !lost) {
                rope[dragging].dx = 0;
                rope[dragging].dy = 0;
            }
			
			if (lost&& mouse.clientX >= 275 && mouse.clientX <= 375
				&& mouse.clientY >= 250 && mouse.clientY <= 300) {
					reset();
					lost = false;
				}
            
            dragging = undefined;    
        }
        
        function handleMove(m) {
            mouse = m.touches ? m.touches[0] : m;
        }
        
        window.onkeydown = function(ev) {
            var key = String.fromCharCode(ev.keyCode);
            
            if (key == "W")
                gravity.y = -0.6;
            if (key == "S")
                gravity.y = 0.6;
            if (key == "A")
                gravity.x = -0.6;
            if (key == "D")
                gravity.x = 0.6;
            if (key == " ") {
                gravity.x = 0;
                gravity.y = 0;
            }
        }
		
		var sX = 325, sY = 500, sR = 100;
        
        function render() {
            //context.fillStyle = "rgb(235, 244, 250)";
            context.clearRect(0, 0, canvas.width, canvas.height);
			
			context.font = "20px Verdana";
			if (lost) {
				context.fillText("Don't touch my balls!", 225, 225);
				
				context.fillStyle = "rgba(125, 125, 125, 0.5)";
				context.fillRect(275, 250, 100, 50);
				context.fillStyle = "black";
				context.fillText("Retry?", 293, 280);
			} else if (win) {
				context.fillText("You win! Nice!", 235, 225);
			}
			
			context.fillStyle = "black";
			context.beginPath();
                context.arc(sX, sY, sR, 0, Math.PI * 2);
			context.fill();
            
            context.fillStyle = "blue";
            context.beginPath();
            for (var i in rope) {
                context.quadraticCurveTo(rope[i].x, rope[i].y,
                                         rope[i].x, rope[i].y);
                context.moveTo(rope[i].x, rope[i].y);
            }
            
            context.strokeStyle = "red";
            context.stroke();
            
            for (var i in rope) {
                
                context.beginPath();
                context.arc(rope[i].x, rope[i].y, 120 * (rope[i].mass - 0.9), 0, Math.PI * 2);
                context.fill();
            }
            
            context.fillStyle = "black";
            context.fillRect(0, canvas.height - 100, canvas.width, 1);
            
            setTimeout(render, 1000 / 60);
        }
        
        function update() {
			win = true;
            for (var i = 0; i < rope.length; ++ i) {
                if (Math.abs(rope[i].dx) >= 0.3 || Math.abs(rope[i].dy) >= 0.3)
					win = false;
				
                var dx = 0, dy = 0, magnitude = 1, extension = 0;
                
                if (i != 0) {
                    dx = rope[i - 1].x - rope[i].x;
                    dy = rope[i - 1].y - rope[i].y;
                    magnitude = Math.sqrt(dx * dx + dy * dy);
                    extension = magnitude - ropeLength;
                }
               
                var dx2 = 0, dy2 = 0, magnitude2 = 1, extension2 = 0;
                
                if (i != rope.length - 1) {
                    dx2 = rope[i + 1].x - rope[i].x;
                    dy2 = rope[i + 1].y - rope[i].y;
                    magnitude2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
                    extension2 = magnitude2 - ropeLength;
                }
                
                
                if (magnitude == 0 || magnitude2 == 0)
                    continue;
                    
                var force = new vector((dx / magnitude * extension) + (dx2 / magnitude2 * extension2),
                                       (dy / magnitude * extension) + (dy2 / magnitude2 * extension2));
                
                
                
                rope[i].dx = rope[i].dx * 0.98 + (force.x * 0.05) + gravity.x;
                rope[i].dy = rope[i].dy * 0.98 + (force.y * 0.05) + gravity.y;
                
                //quick hack, heavier objects get more acceleration
                
				/*
                rope[i].dx = rope[i].dx * rope[i].mass + (force.x * 0.05) + gravity.x;
                rope[i].dy = rope[i].dy * rope[i].mass + (force.y * 0.05) + gravity.y;
				*/
                
                //collision
                if (rope[i].y >= canvas.height - 100 && rope[i].dy > 0 ||
                    rope[i].y <= 10 && rope[i].dy < 0) {
                    
                    rope[i].dy = -rope[i].dy * rope[i].mass;
                    
                    if (Math.abs(rope[i].dy) < rope[i].mass * 2.9)
                        rope[i].dy = 0;
                    
                    //surface friction
                    rope[i].dx *= 0.5;
                }
                
                //collision
                if (rope[i].x >= canvas.width && rope[i].dx > 0 ||
                    rope[i].x <= 0 && rope[i].dx < 0) {
                    rope[i].dx = -rope[i].dx * rope[i].mass;
                    
                    if (Math.abs(rope[i].dx) < rope[i].mass * 2.9)
                        rope[i].dx = 0;
                    
                    //surface friction
                    rope[i].dy *= 0.5;
                }
				
				//ball collision
				var dx = rope[i].x - sX, dy = rope[i].y - sY,
					dist = Math.sqrt(dx * dx + dy * dy);
				if (dist < sR + 120 * (rope[i].mass - 0.9))
				{
					// lost = true;
					
					rope[i].dx += (dx / dist) * Math.abs(rope[i].dx) * (1 / rope[i].mass) * 1.3;
					rope[i].dy += (dy / dist) * Math.abs(rope[i].dy) * (1 / rope[i].mass) * 1.3;

					rope[i].dx -= 0.1;
					rope[i].dy -= 0.1;
				}
                
                //rope friction
                rope[i].dx *= 0.96;
                rope[i].dy *= 0.96;
                
                rope[i].x += rope[i].dx;
                rope[i].y += rope[i].dy;
            }
            
            //console.log(rope[0].y);
            
            if (dragging != undefined) {
                rope[dragging].x = mouse.x;
                rope[dragging].y = mouse.y;
            }
            
            setTimeout(update, 1000 / 30);
        }
        
        render();
        update();

    </script>
</html>