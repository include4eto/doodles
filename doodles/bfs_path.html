<html>
	<body>
		<canvas id="asdf" width="600px" height="600px"></canvas>
	</body>
	
	<script>
		var canvas = document.getElementById("asdf"),
			context = canvas.getContext("2d");
			
		var map = [],
			mapSize = 20,
			squareSize = canvas.width / mapSize;
		for (var i = 0; i < mapSize; i++) {
			map[i] = [];
			for (var k = 0; k < mapSize; k++)
				map[i][k] = Math.random() > 0.80 ? 1 : 0;
		}
		
		var path = [],
			queue = [[0, 0, undefined]],
			tracebackNode;
			
		function traceback() {
			map[tracebackNode[0]][tracebackNode[1]] = 3;
			if (tracebackNode[2] != undefined) {
				tracebackNode = tracebackNode[2];
				setTimeout(traceback, 50);
			}
		}
			
		function bfs() {
			var node = queue.splice(0, 1)[0];
			if (map[node[0]][node[1]] == 2) {
				setTimeout(bfs, 1);
				return;
			}
				
			map[node[0]][node[1]] = 2;
			
			if (node[0] + 1 < mapSize && map[node[0] + 1][node[1]] == 0)
				queue.push([node[0] + 1, node[1], node]);
			if (node[1] + 1 < mapSize && map[node[0]][node[1] + 1] == 0)
				queue.push([node[0], node[1] + 1, node]);
			if (node[0] - 1 >= 0 && map[node[0] - 1][node[1]] == 0)
				queue.push([node[0] - 1, node[1], node]);
			if (node[1] - 1 >= 0 && map[node[0]][node[1] - 1] == 0)
				queue.push([node[0], node[1] - 1, node]);
			
			if (node[0] == mapSize - 1 && node[1] == mapSize - 1) {
				tracebackNode = node;
				traceback();
				return;
			}
				
			if (queue.length != 0)
				setTimeout(bfs, 1);
		}
		bfs();
		
		function draw() {
			context.clearRect(0, 0, canvas.width, canvas.height);
			
			for (var i = 0; i <= mapSize; i++) {
				context.beginPath();
				{
					context.moveTo(squareSize * i, 0);
					context.lineTo(squareSize * i, canvas.height);
					
					context.moveTo(0, squareSize * i);
					context.lineTo(canvas.width, squareSize * i);
				}
				context.stroke();
			}
			
			for (var y = 0; y < mapSize; y++)
				for (var x = 0; x < mapSize; x++) {
					context.fillStyle = "rgba(0, 0, 0, 0.3)";
					if (map[x][y] == 2)
						context.fillStyle = "rgba(0, 255, 0, 0.3)";
					if (map[x][y] == 3)
						context.fillStyle = "rgba(255, 0, 0, 0.3)";
					if (map[x][y] != 0)
						context.fillRect(x * squareSize, y * squareSize, squareSize, squareSize);
				}
		}
		
		setInterval(draw, 16);
	</script>
</html>